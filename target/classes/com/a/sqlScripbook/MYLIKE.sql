DROP TABLE MYLIKE
CASCADE CONSTRAINTS;

DROP SEQUENCE LIKE_SEQ;

SELECT * FROM MYLIKE
-- 제안하기(마이페이지) 게시판 좋아요

CREATE TABLE MYLIKE(
		LIKESEQ NUMBER CONSTRAINT MYLIKE_PRI PRIMARY KEY,
		SUGGESTBBSSEQ NUMBER,
		EMAIL VARCHAR2(50),
		LIKECHECK NUMBER
  		CONSTRAINT FK_LIKE FOREIGN KEY (SUGGESTBBSSEQ) 
        REFERENCES SUGGESTBBS(SUGGESTBBSSEQ),
        CONSTRAINT FK_LIKE2 FOREIGN KEY (EMAIL) 
        REFERENCES MEMBER(EMAIL)
)

ALTER TABLE MYLIKE ADD (LIKECHECK NUMBER)

ALTER TABLE MYLIKE DROP COLUMN LIKECHECK

CREATE SEQUENCE LIKE_SEQ
START WITH 5000
INCREMENT BY 1

INSERT INTO MYLIKE(LIKESEQ, SUGGESTBBSSEQ, EMAIL, LIKECHECK)
VALUES(LIKE_SEQ.NEXTVAL, 10021, 'yw_0000@naver.com', 1)

SELECT * FROM SUGGESTBBS
SELECT * FROM MEMBER
SELECT * FROM MYLIKE


-- 좋아요 한 정보를 left join으로 가져온다.
SELECT SBS.*,
CASE WHEN CNT.LIKECNT IS NULL THEN 0 ELSE CNT.LIKECNT END AS LIKECNT,
CASE WHEN ML.SUGGESTBBSSEQ IS NULL THEN 0 ELSE 1 END AS LIKECHECK
FROM SUGGESTBBS SBS
LEFT JOIN (SELECT SUGGESTBBSSEQ,COUNT(*) AS LIKECNT FROM MYLIKE GROUP BY SUGGESTBBSSEQ) CNT
ON SBS.SUGGESTBBSSEQ = CNT.SUGGESTBBSSEQ
LEFT JOIN (SELECT SUGGESTBBSSEQ FROM MYLIKE WHERE EMAIL = 'yw_0000@naver.com') ML
ON SBS.SUGGESTBBSSEQ = ML.SUGGESTBBSSEQ
WHERE SBS.SUGGESTBBSDEL = 0