DROP TABLE CHALLENGEMEMBER
CASCADE CONSTRAINTS;

DROP SEQUENCE CHALMEM_SEQ;

--CHALLENGEMEMBER

CREATE TABLE CHALLENGEMEMBER(
		CHALLENGMEMSEQ NUMBER CONSTRAINT CHALLMEM_PRI PRIMARY KEY,
		IDENTIFY NUMBER,  --인증 횟수
		SUCCESS NUMBER -- 성공실패 성공시1 85퍼이상 2 실패3
		CHALLENGESEQ NUMBER,
		EMAIL VARCHAR2(50) NOT NULL,
  		CONSTRAINT FK_CHALMEM FOREIGN KEY (EMAIL) 
        REFERENCES MEMBER(EMAIL), 
        CONSTRAINT FK_CHALMEM2 FOREIGN KEY (CHALLENGESEQ) 
        REFERENCES CHALLENGE(CHALLENGESEQ) 
)

ALTER TABLE CHALLENGEMEMBER ADD(CHALLENGESEQ NUMBER)

ALTER TABLE CHALLENGEMEMBER
ADD CONSTRAINT FK_CHALMEM1
FOREIGN KEY(EMAIL)
REFERENCES MEMBER(EMAIL)

ALTER TABLE CHALLENGEMEMBER
ADD CONSTRAINT FK_CHALMEM2
FOREIGN KEY(CHALLENGESEQ)
REFERENCES CHALLENGE(CHALLENGESEQ)

ALTER TABLE CHALLENGEMEMBER ADD SUCCESS NUMBER;

CREATE SEQUENCE CHALMEM_SEQ
START WITH 100
INCREMENT BY 1

SELECT * FROM CHALLENGEMEMBER

UPDATE MEMBER
SET POINT = 10000
WHERE EMAIL = 'final.5623@gmail.com'

UPDATE MEMBER
		SET POINT = POINT-5
		WHERE EMAIL = 'final.5623@gmail.com'
		

SELECT CM.CHALLENGMEMSEQ, M.EMAIL, M.NICKNAME, M.MEMBERPHOTONAME, M.POINT, CM.CHALLENGESEQ, CM.IDENTIFY
FROM MEMBER M, CHALLENGEMEMBER CM
WHERE M.EMAIL = CM.EMAIL
	AND CM.CHALLENGESEQ = 1100
ORDER BY CM.CHALLENGMEMSEQ DESC

SELECT * FROM CHALLENGE WHERE CHALLENGESEQ = 1100

SELECT * FROM MEMBER
UPDATE CHALLENGE
		SET CHALLENGEMEMBER = CHALLENGEMEMBER+1
		WHERE CHALLENGESEQ = 1100	

SELECT CHALLENGMEMSEQ, IDENTIFY, SUCCESS, CHALLENGESEQ, EMAIL
FROM CHALLENGEMEMBER

SELECT * FROM CERTIFY
SELECT CURRENT_DATE FROM DUAL

INSERT INTO CERTIFY(CERTIFYSEQ, CERTIFYPHOTO, CERTIFYPHOTONAME, CERTIFYDATE, EMAIL, CHALLENGESEQ)
VALUES(CERT_SEQ.NEXTVAL,'0','0', CURRENT_DATE, 'final.5623@gmail.com', 1000)

SELECT ROW_NUMBER()OVER(ORDER BY CM.IDENTIFY DESC) AS RNUM, CM.IDENTIFY, CM.SUCCESS, CM.CHALLENGESEQ AS CHALSEQ, M.EMAIL AS EM, M.NICKNAME, M.MEMBERPHOTONAME, C.CHALLENGEPERIOD*14 AS TOTALDAY
		FROM CHALLENGEMEMBER CM, MEMBER M,  CHALLENGE C
		WHERE M.EMAIL = CM.EMAIL
			AND C.CHALLENGESEQ = CM.CHALLENGESEQ
			AND M.EMAIL = CM.EMAIL
			AND CM.CHALLENGESEQ = 1000
			
			
		SELECT COUNT(*) AS CERTIFYCHECK
		FROM CERTIFY
		WHERE CERTIFYDATE >= TO_DATE(TO_CHAR(CURRENT_DATE, 'YYYY-MM-DD HH24'), 'YYYY-MM-DD HH24')
			AND CERTIFYDATE <= TO_DATE(TO_CHAR(CURRENT_DATE, 'YYYY-MM-DD HH24'), 'YYYY-MM-DD HH24')+(600/86400)
			AND EMAIL = 'final.5623@gmail.com'
			AND CHALLENGESEQ = 1000