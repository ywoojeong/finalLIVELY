<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myPage">
	
	<select id="getNowCh" resultType="java.util.Map" parameterType="java.util.Map">
		SELECT NOWCNT.*,
			(SELECT 
			COUNT(*) AS TOTAL
			FROM CHALLENGEMEMBER CM
			INNER JOIN CHALLENGE CG
			ON CM.CHALLENGESEQ = CG.CHALLENGESEQ
			WHERE SYSDATE > CG.CHALLENGESTART AND CG.CHALLENGEEND > SYSDATE AND CM.EMAIL = #{email}
			) AS NOWCNT2
		FROM 
			(SELECT 
			COUNT(*) AS TOTAL
			FROM CHALLENGEMEMBER CM
			INNER JOIN CHALLENGE CG
			ON CM.CHALLENGESEQ = CG.CHALLENGESEQ
			WHERE CM.EMAIL = #{email}
			) NOWCNT
	</select>
	
	<select id="getCompleCh" resultType="java.util.Map" parameterType="java.util.Map">
		SELECT NOWCNT.*,
			(SELECT 
			COUNT(*) AS TOTAL
			FROM CHALLENGEMEMBER CM
			INNER JOIN CHALLENGE CG
			ON CM.CHALLENGESEQ = CG.CHALLENGESEQ
			WHERE SYSDATE > CG.CHALLENGESTART AND CG.CHALLENGEEND > SYSDATE
			) AS NOWCNT2
		FROM 
			(SELECT 
			COUNT(*) AS TOTAL
			FROM CHALLENGEMEMBER CM
			INNER JOIN CHALLENGE CG
			ON CM.CHALLENGESEQ = CG.CHALLENGESEQ
			WHERE CM.EMAIL = #{email}
			) NOWCNT
	</select>
	
	<!-- 회원 정보 -->
	<select id="memberInfoData" parameterType="java.lang.String" resultType="java.util.Map">
		SELECT * FROM MEMBER WHERE EMAIL = #{value}
	</select>
	
	<!-- 내가 찜한 챌린지 갯수-->
	<select id="memberWishCount" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM CHALLENGEWISH
		WHERE EMAIL = #{email}
	</select>
	
	<!-- 내가 진행중인 챌린지 갯수 -->
	<select id="memberNowCount" resultType="java.lang.Integer">
		SELECT COUNT(*) AS memNowCnt
		FROM CHALLENGE CG
		INNER JOIN CHALLENGEMEMBER CM
		ON CM.CHALLENGESEQ = CG.CHALLENGESEQ
		WHERE SYSDATE > CG.CHALLENGESTART AND CG.CHALLENGEEND > SYSDATE
		AND CM.EMAIL = #{email}
	</select>
	
	<!-- 내가 진행준일 챌린지 리스트 -->
	<select id="memNowCntList" resultType="java.util.Map">
		SELECT CG.CATEGORY, CG.IDENTIFYFREQUENCY, CG.CHALLENGEPERIOD, CG.CHALLENGETITLE
		FROM CHALLENGE CG
		INNER JOIN CHALLENGEMEMBER CM
		ON CM.CHALLENGESEQ = CG.CHALLENGESEQ
		WHERE SYSDATE > CG.CHALLENGESTART AND CG.CHALLENGEEND > SYSDATE
		AND CM.EMAIL = #{email}
	</select>
	
</mapper>